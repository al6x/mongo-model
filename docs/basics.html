<!DOCTYPE html>  <html> <head>   <title>basics.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="assignment.html">                 assignment.coffee               </a>                                           <a class="source" href="associations.html">                 associations.coffee               </a>                                           <a class="source" href="basics.html">                 basics.coffee               </a>                                           <a class="source" href="callbacks.html">                 callbacks.coffee               </a>                                           <a class="source" href="composite.html">                 composite.coffee               </a>                                           <a class="source" href="database.html">                 database.coffee               </a>                                           <a class="source" href="driver.html">                 driver.coffee               </a>                                           <a class="source" href="examples-spec.html">                 examples-spec.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="modifiers.html">                 modifiers.coffee               </a>                                           <a class="source" href="queries.html">                 queries.coffee               </a>                                           <a class="source" href="synchronous.html">                 synchronous.coffee               </a>                                           <a class="source" href="validations.html">                 validations.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               basics.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Basic example for <a href="model.html">Model</a>.</p>

<p>In this example we'll create simple Model and examine basic CRUD and
querying operations.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_     = </span><span class="nx">require</span> <span class="s1">&#39;underscore&#39;</span>
<span class="nv">Model = </span><span class="nx">require</span> <span class="s1">&#39;mongo-model&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Enabling optional <a href="synchronous.html">synchronous</a> mode.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">require</span> <span class="s1">&#39;mongo-model/lib/sync&#39;</span>
<span class="nv">sync = </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Connecting to default database and clearing it before starting.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">db = </span><span class="nx">Model</span><span class="p">.</span><span class="nx">db</span><span class="p">()</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Defining Model</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Let's define a game Unit.</p>

<p>Models are (almost) just plain JavaScript Objects, there's no any Attribute Scheme,
Types, Proxies, or other complex stuff. Just simple objects and arrays, use standard
JS practices for working with it.</p>

<p>Inheriting our Unit from Model (make sure that Model is visible in global scope by
using <code>global.Unit</code> instead of just <code>Unit</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nx">global</span><span class="p">.</span><span class="nx">Unit</span> <span class="k">extends</span> <span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Specifying collection name this model will be saved to.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@collection</span> <span class="s1">&#39;units&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>There's no need to explicitly declare attributes, just use it as if it's a plain object.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Creating another Model, containing statistics about our Unit (it will be embedded into the
Unit).</p>

<p>There are no difference between the Main and Embedded Models any Model can be used as a Main or
be Embedded in another.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">class</span> <span class="nx">global</span><span class="p">.</span><span class="nx">Stats</span> <span class="k">extends</span> <span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>CRUD</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Let's create two great Heroes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">zeratul  = </span><span class="k">new</span> <span class="nx">Unit</span> <span class="nv">name: </span><span class="s1">&#39;Zeratul&#39;</span><span class="p">,</span>  <span class="nv">status: </span><span class="s1">&#39;alive&#39;</span>
  <span class="nv">zeratul.stats = </span> <span class="k">new</span> <span class="nx">Stats</span> <span class="nv">attack: </span><span class="mi">85</span><span class="p">,</span> <span class="nv">life: </span><span class="mi">300</span><span class="p">,</span> <span class="nv">shield: </span><span class="mi">100</span>

  <span class="nv">tassadar = </span><span class="k">new</span> <span class="nx">Unit</span> <span class="nv">name: </span><span class="s1">&#39;Tassadar&#39;</span><span class="p">,</span> <span class="nv">status: </span><span class="s1">&#39;dead&#39;</span>
  <span class="nv">tassadar.stats = </span><span class="k">new</span> <span class="nx">Stats</span> <span class="nv">attack: </span><span class="mi">0</span><span class="p">,</span>  <span class="nv">life: </span><span class="mi">80</span><span class="p">,</span>  <span class="nv">shield: </span><span class="mi">300</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Saving units to database.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">assert</span> <span class="nx">zeratul</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span> <span class="kc">true</span>
  <span class="nx">assert</span> <span class="nx">tassadar</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>We made an error - mistakenly set Tassadar's attack as zero, let's fix it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tassadar.stats.attack = </span><span class="mi">20</span>
  <span class="nx">assert</span> <span class="nx">tassadar</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>Querying</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>All methods are (amost) the same as in MongoDB.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">assert</span> <span class="nx">Unit</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nv">name: </span><span class="s1">&#39;Zeratul&#39;</span><span class="p">).</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;Zeratul&#39;</span>
  <span class="nv">list = </span><span class="nx">Unit</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nv">name: </span><span class="s1">&#39;Zeratul&#39;</span><span class="p">)</span>
  <span class="nx">assert</span> <span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(obj) -&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Zeratul&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>There's also advanced <code>next</code> method, but we don't cover it in this sample.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Query helpers.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">assert</span> <span class="nx">Unit</span><span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">sort</span><span class="p">(</span><span class="nv">name: </span><span class="mi">1</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;Tassadar&#39;</span>
  <span class="nx">assert</span> <span class="nx">Unit</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nv">name: </span><span class="s1">&#39;Zeratul&#39;</span><span class="p">).</span><span class="nx">count</span><span class="p">(),</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Other</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Instead of default <code>BSON::ObjectId</code> id, Dirver generates
short and nice random string ids (can be disabled in config).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">assert</span> <span class="nx">Unit</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">_id</span><span class="p">.</span><span class="nx">constructor</span><span class="p">,</span> <span class="nb">String</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>You also can convert model to Hash.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">assert</span> <span class="nx">Unit</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">toHash</span><span class="p">().</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;Zeratul&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Closing connection.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>This stuff needed for <a href="synchronous.html">synchronous</a> mode.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Fiber</span><span class="p">(</span><span class="nx">sync</span><span class="p">).</span><span class="nx">run</span><span class="p">()</span>

<span class="nv">global.assert = </span><span class="nf">(args...) -&gt;</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">).</span><span class="nx">deepEqual</span> <span class="nx">args</span><span class="p">...</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>In this example we covered basics of <a href="model.html">Model</a>,
please go to <a href="model.html">contents</a> for more samples.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 